<!DOCTYPE html>
<html>
<head>
    <title>GPT Output Decision-Making</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        .outer-container {
            background-color: #f8f9fa;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 900px;
            text-align: center;
        }
        .module-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .container {
            background-color: #bae9ff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            opacity: 0;
            animation: fadein 1.7s ease-in-out forwards;
        }
        .input-section, .options-section, .output-section {
            margin: 20px 0;
        }
        .options {
            display: flex;
            justify-content: space-around;
        }
        .option {
            background-color: #e5f6ff;
            padding: 20px;
            border-radius: 5px;
            width: 150px;
            text-align: center;
            font-size: 1.2em;
        }
        .option span {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        .submit-button, .continue-button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            margin-top: 20px;
            text-decoration: none;
        }
        .submit-button:hover, .continue-button:hover {
            background-color: #0056b3;
        }
        .loading {
            display: none;
            text-align: center;
            font-size: 1.5em;
        }
        .module-text {
            max-width: 800px;
            margin-bottom: 20px;
            text-align: center;
            background-color: #e6f7ff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            animation: fadein 1.7s ease-in-out forwards;
        }
        @keyframes fadein {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body onload="maximizeWindow()">
    <div class="outer-container">
        <div class="module-text" style="animation-delay: 1.7s;">
            <h2>GPT Models</h2>
            <div class="container" style="animation-delay: 3.4s;">
                <p>GPT models take this approach and apply it to text. The program works by splitting up a sentence into four character chunks called “tokens”:</p>
                <p>Hello my good sir.</p>
                <p>[Hell] [o my] [ goo] [d si] [r.  ]</p>
            </div>
            <div class="container" style="animation-delay: 5.1s;">
                <p>The “binary activation functions” are generated based on how close these “tokens” are to other “tokens”, and what “tokens" are grouped together, and how close those groups are to other “token” groups, and <i>oh boy this is getting complicated</i>. Basically, there are a lot of ways text can be related to surrounding text, and the result is a huge mesh generalizing the English language.</p>
            </div>
            <div class="container" style="animation-delay: 6.8s;">
                <p>At runtime, a GPT model takes in some text and generates possible next tokens with associated probabilities. It then randomly chooses one based on these probabilities, then feeds the whole thing back into the program (it's a little more nuanced in practice, but this is generally how it works).</p>
            </div>
        </div>
        <div class="module-container">
            <div class="container">
                <p>This demonstration simulates the process of choosing the next four tokens. Try it out!</p>
                <div class="input-section">
                    <input type="text" id="userSentence" placeholder="Enter your sentence here" style="width: 70%; padding: 20px; border-radius: 5px; border: 1px solid #007bff; font-size: 1.2em;">
                    <button id="submitButton" class="submit-button">Submit</button>
                </div>
                <div class="loading" id="loading">Loading...</div>
                <div class="options-section options">
                    <div class="option">
                        Option 1:
                        <span id="option1"></span>
                    </div>
                    <div class="option">
                        Option 2:
                        <span id="option2"></span>
                    </div>
                    <div class="option">
                        Option 3:
                        <span id="option3"></span>
                    </div>
                    <div class="option">
                        Option 4:
                        <span id="option4"></span>
                    </div>
                </div>
                <div class="output-section">
                    <span id="output"></span>
                </div>
            </div>
        </div>
        <button class="continue-button" onclick="location.href='takeaways.html'" style="animation-delay: 8.5s;">Continue</button>
    </div>
    <script type="text/javascript" src="../eel.js"></script>
    <script>
        const userInput = document.getElementById('userSentence');
        const loading = document.getElementById('loading');
        const options = ["option1", "option2", "option3", "option4"];
        const output = document.getElementById('output');
        let cooldown = false;

        function maximizeWindow() {
            window.moveTo(0, 0);
            window.resizeTo(screen.width, screen.height);
        }

        async function doFourSteps() {
            if (cooldown) return;
            cooldown = true;
            loading.style.display = 'block';
            let userSentence = userInput.value;
            console.log("User sentence: ", userSentence);
            for (let i = 0; i < 4; i++) {
                console.log(`Step ${i+1} started`);
                try {
                    const result = await eel.doFourSteps(userSentence)();
                    console.log(`Result from step ${i+1}:`, result);
                    options.forEach((option, index) => {
                        document.getElementById(option).innerText = result[index];
                    });
                    userSentence += result[4];
                    output.innerText = userSentence;
                    console.log(`Step ${i+1} completed`);
                } catch (error) {
                    console.error(`Error in step ${i+1}:`, error);
                    break;
                }
                await new Promise(resolve => setTimeout(resolve, 4000));
            }
            loading.style.display = 'none';
            cooldown = false;
            userInput.value = ""; // Clear the input field
            console.log("Processing completed, input field cleared");
        }

        function updateLoadingText() {
            const loadingTexts = ["Loading.", "Loading..", "Loading..."];
            let index = 0;
            setInterval(() => {
                loading.innerText = loadingTexts[index];
                index = (index + 1) % loadingTexts.length;
            }, 500);
        }

        document.getElementById('submitButton').addEventListener('click', doFourSteps);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                doFourSteps();
            }
        });

        updateLoadingText();

        eel.expose(updateOptions);
        function updateOptions(option1, option2, option3, option4) {
            document.getElementById('option1').innerText = option1;
            document.getElementById('option2').innerText = option2;
            document.getElementById('option3').innerText = option3;
            document.getElementById('option4').innerText = option4;
        }

        eel.expose(updateSentence);
        function updateSentence(sentence) {
            document.getElementById('output').innerText = sentence;
        }
    </script>
</body>
</html>
